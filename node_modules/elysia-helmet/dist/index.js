// @bun
import W from"elysia";var x={"default-src":["'self'"],"base-uri":["'self'"],"font-src":["'self'","https:","data:"],"form-action":["'self'"],"frame-ancestors":["'self'"],"img-src":["'self'","data:"],"object-src":["'none'"],"script-src":["'self'"],"script-src-attr":["'none'"],"style-src":["'self'","https:","'unsafe-inline'"],"upgrade-insecure-requests":[]},b=(e)=>e.replace(/[A-Z]/g,(o)=>`-${o.toLowerCase()}`),D=(e)=>/;|,/.test(e),V=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),X=()=>({...x}),T=(e)=>{const o=X(),{useDefaults:r=!0,directives:n=o}=e,s=new Map,c=new Set,l=new Set;for(let t in n){if(!V(n,t))continue;if(t.length===0||/[^a-zA-Z0-9-]/.test(t))throw new Error(`Content-Security-Policy received an invalid directive name ${JSON.stringify(t)}`);const i=b(t);if(c.has(i))throw new Error(`Content-Security-Policy received a duplicate directive ${JSON.stringify(i)}`);c.add(i);const a=n[t];if(a===null){if(i==="default-src")throw new Error("Content-Security-Policy needs a default-src but it was set to `null`.");l.add(i);continue}if(!a)throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(i)}`);const y=typeof a==="string"?[a]:a;for(let R of y)if(typeof R==="string"&&D(R))throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(i)}`);s.set(i,y)}if(r)Object.entries(o).forEach(([t,i])=>{if(!s.has(t)&&!l.has(t))s.set(t,i)});if(!s.size)throw new Error("Content-Security-Policy has no directives. Either set some or disable the header");return s},A=(e)=>{let o;const r=[];return e.forEach((n,s)=>{const c=n.reduce((l,t)=>`${l} ${t}`,"");if(!c)r.push(s);else if(D(c))o=new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(s)}`);else r.push(`${s}${c}`)}),o||r.join(";")},u=(e={})=>{const o=e.reportOnly?"Content-Security-Policy-Report-Only":"Content-Security-Policy",r=T(e),n=A(r);if(n instanceof Error)throw n;return[o,n]};var N=new Set(["require-corp","credentialless"]),$=({policy:e="require-corp"})=>{if(N.has(e))return e;throw new Error(`Cross-Origin-Embedder-Policy does not support the ${JSON.stringify(e)} policy`)},p=(e={})=>{return["Cross-Origin-Embedder-Policy",$(e)]};var I=new Set(["same-origin","same-origin-allow-popups","unsafe-none"]),L=({policy:e="same-origin"})=>{if(I.has(e))return e;throw new Error(`Cross-Origin-Opener-Policy does not support the ${JSON.stringify(e)} policy`)},d=(e={})=>{return["Cross-Origin-Opener-Policy",L(e)]};var F=new Set(["same-origin","same-site","cross-origin"]),J=({policy:e="same-origin"})=>{if(F.has(e))return e;throw new Error(`Cross-Origin-Resource-Policy does not support the ${JSON.stringify(e)} policy`)},g=(e={})=>{return["Cross-Origin-Resource-Policy",J(e)]};var f=()=>{return["Cross-Origin-Resource-Policy","?1"]};var _=new Set(["no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url",""]),M=({policy:e="no-referrer"})=>{const o=typeof e==="string"?[e]:e;if(o.length===0)throw new Error("Referrer-Policy received no policy tokens");const r=new Set;return o.forEach((n)=>{if(!_.has(n))throw new Error(`Referrer-Policy received an unexpected policy token ${JSON.stringify(n)}`);else if(r.has(n))throw new Error(`Referrer-Policy received a duplicate policy token ${JSON.stringify(n)}`);r.add(n)}),o.join(",")},O=(e={})=>{return["Referrer-Policy",M(e)]};var z=(e=15552000)=>{if(e>=0&&Number.isFinite(e))return Math.floor(e);throw new Error(`Strict-Transport-Security: ${JSON.stringify(e)} is not a valid value for maxAge. Please choose a positive integer.`)},j=(e)=>{if("maxage"in e)throw new Error("Strict-Transport-Security received an unsupported property, `maxage`. Did you mean to pass `maxAge`?");if("includeSubdomains"in e)throw new Error('Strict-Transport-Security middleware should use `includeSubDomains` instead of `includeSubdomains`. (The correct one has an uppercase "D".)');const o=[`max-age=${z(e.maxAge)}`];if(e.includeSubDomains===void 0||e.includeSubDomains)o.push("includeSubDomains");if(e.preload)o.push("preload");return o.join("; ")},m=(e={})=>{return["Strict-Transport-Security",j(e)]};var h=()=>{return["X-Content-Type-Options","nosniff"]};var P=(e={})=>{return["X-DNS-Prefetch-Control",e.allow?"on":"off"]};var S=()=>{return["X-Download-Options","noopen"]};var k=({action:e="sameorigin"})=>{const o=typeof e==="string"?e.toUpperCase():e;switch(o){case"SAME-ORIGIN":return"SAMEORIGIN";case"DENY":case"SAMEORIGIN":return o;default:throw new Error(`X-Frame-Options received an invalid action ${JSON.stringify(e)}`)}},w=(e={})=>{return["X-Frame-Options",k(e)]};var q=new Set(["none","master-only","by-content-type","all"]),G=({permittedPolicies:e="none"})=>{if(q.has(e))return e;throw new Error(`X-Permitted-Cross-Domain-Policies does not support ${JSON.stringify(e)}`)},E=(e={})=>{return["X-Permitted-Cross-Domain-Policies",G(e)]};var C=()=>{return["X-XSS-Protection","0"]};var v=(e,o,r)=>{switch(r.contentSecurityPolicy){case void 0:case!0:e(u());break;case!1:break;default:e(u(r.contentSecurityPolicy));break}switch(r.crossOriginEmbedderPolicy){case void 0:case!1:break;case!0:e(p());break;default:e(p(r.crossOriginEmbedderPolicy));break}switch(r.crossOriginOpenerPolicy){case void 0:case!0:e(d());break;case!1:break;default:e(d(r.crossOriginOpenerPolicy));break}switch(r.crossOriginResourcePolicy){case void 0:case!0:e(g());break;case!1:break;default:e(g(r.crossOriginResourcePolicy));break}switch(r.originAgentCluster){case void 0:case!0:e(f());break;case!1:break;default:e(f());break}switch(r.referrerPolicy){case void 0:case!0:e(O());break;case!1:break;default:e(O(r.referrerPolicy));break}if("strictTransportSecurity"in r&&"hsts"in r)throw new Error("Strict-Transport-Security option was specified twice. Remove `hsts` to silence this warning.");const n=r.strictTransportSecurity??r.hsts;switch(n){case void 0:case!0:e(m());break;case!1:break;default:e(m(n));break}if("xContentTypeOptions"in r&&"noSniff"in r)throw new Error("X-Content-Type-Options option was specified twice. Remove `noSniff` to silence this warning.");switch(r.xContentTypeOptions??r.noSniff){case void 0:case!0:e(h());break;case!1:break;default:e(h());break}if("xDnsPrefetchControl"in r&&"dnsPrefetchControl"in r)throw new Error("X-DNS-Prefetch-Control option was specified twice. Remove `dnsPrefetchControl` to silence this warning.");const c=r.xDnsPrefetchControl??r.dnsPrefetchControl;switch(c){case void 0:case!0:e(P());break;case!1:break;default:e(P(c));break}if("xDownloadOptions"in r&&"ieNoOpen"in r)throw new Error("X-Download-Options option was specified twice. Remove `ieNoOpen` to silence this warning.");switch(r.xDownloadOptions??r.ieNoOpen){case void 0:case!0:e(S());break;case!1:break;default:e(S());break}if("xFrameOptions"in r&&"frameguard"in r)throw new Error("X-Frame-Options option was specified twice. Remove `frameguard` to silence this warning.");const t=r.xFrameOptions??r.frameguard;switch(t){case void 0:case!0:e(w());break;case!1:break;default:e(w(t));break}if("xPermittedCrossDomainPolicies"in r&&"permittedCrossDomainPolicies"in r)throw new Error("X-Permitted-Cross-Domain-Policies option was specified twice. Remove `permittedCrossDomainPolicies` to silence this warning.");const i=r.xPermittedCrossDomainPolicies??r.permittedCrossDomainPolicies;switch(i){case void 0:case!0:e(E());break;case!1:break;default:e(E(i));break}if("xPoweredBy"in r&&"hidePoweredBy"in r)throw new Error("X-Powered-By option was specified twice. Remove `hidePoweredBy` to silence this warning.");switch(r.xPoweredBy??r.hidePoweredBy){case void 0:case!0:o("X-Powered-By");break;case!1:break;default:o("X-Powered-By");break}if("xXssProtection"in r&&"xssFilter"in r)throw new Error("X-XSS-Protection option was specified twice. Remove `xssFilter` to silence this warning.");switch(r.xXssProtection??r.xssFilter){case void 0:case!0:e(C());break;case!1:break;default:e(C());break}};var Ae=(e={})=>{return new W({name:"elysia-helmet",seed:e.seed??"",aot:e.aot??!0}).onRequest(({set:o})=>{v(([r,n])=>o.headers[r]=n,(r)=>delete o.headers[r],e)})};export{Ae as helmet};
